<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Scraper Pro - Supervised Mode</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_supervised.css') }}">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="logo">üéØ Lead Scraper Pro <span class="badge-new">Supervised</span></h1>
                <button class="btn-config" onclick="showConfig()">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor">
                        <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" stroke-width="1.5"/>
                        <path d="M17.5 10c0 .45-.05.9-.15 1.35l1.6 1.25-1.5 2.6-2-.8c-.65.5-1.4.85-2.2 1.05l-.35 2.1h-3l-.35-2.1c-.8-.2-1.55-.55-2.2-1.05l-2 .8-1.5-2.6 1.6-1.25c-.1-.45-.15-.9-.15-1.35s.05-.9.15-1.35l-1.6-1.25 1.5-2.6 2 .8c.65-.5 1.4-.85 2.2-1.05l.35-2.1h3l.35 2.1c.8.2 1.55.55 2.2 1.05l2-.8 1.5 2.6-1.6 1.25c.1.45.15.9.15 1.35z" stroke-width="1.5"/>
                    </svg>
                    Configuration
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Step 1: Analyze URL -->
            <div id="step-analyze" class="step-section">
                <div class="card">
                    <div class="card-header">
                        <h2>üîç √âtape 1 : Analyser la page</h2>
                        <p>Entrez l'URL pour d√©tecter automatiquement les donn√©es</p>
                    </div>
                    <div class="card-body">
                        <div class="info-banner">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"/>
                            </svg>
                            <div>
                                <strong>Scraping supervis√©</strong> - Vous choisissez quelle colonne contient les noms d'entreprises
                            </div>
                        </div>

                        <div class="form-group">
                            <label>URL du site √† analyser</label>
                            <input type="url"
                                   id="analyze-url"
                                   class="input-modern"
                                   placeholder="https://example.com/annuaire"
                                   value="https://www.batiweb.com/fabricants-btp">
                        </div>

                        <button class="btn btn-primary btn-lg" onclick="analyzeUrl()">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"/>
                            </svg>
                            Analyser et d√©tecter les patterns
                        </button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Choose Pattern & Map Columns -->
            <div id="step-mapping" class="step-section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>üìä √âtape 2 : Mapper les donn√©es</h2>
                        <p>Choisissez le pattern et la colonne contenant les noms d'entreprises</p>
                    </div>
                    <div class="card-body">
                        <!-- Pattern Selector -->
                        <div class="pattern-selector" id="pattern-selector">
                            <!-- Filled by JS -->
                        </div>

                        <!-- Column Mapping -->
                        <div id="column-mapping" style="display: none;">
                            <div class="info-banner" style="background: #fef3c7; border-color: #fbbf24; color: #92400e;">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"/>
                                </svg>
                                <div>
                                    <strong>S√©lectionnez UNE SEULE colonne</strong> - Choisissez celle qui contient les noms d'entreprises. Les autres colonnes seront ignor√©es.
                                </div>
                            </div>

                            <div class="form-group">
                                <label>üéØ Quelle colonne contient les noms d'entreprises ?</label>
                                <select id="company-column" class="input-modern">
                                    <!-- Filled by JS -->
                                </select>
                                <small>Seuls les noms de cette colonne seront extraits et sauvegard√©s</small>
                            </div>

                            <!-- Data Preview -->
                            <div class="data-preview">
                                <h4>Aper√ßu des donn√©es</h4>
                                <div class="table-wrapper">
                                    <table id="preview-table" class="data-table">
                                        <!-- Filled by JS -->
                                    </table>
                                </div>
                            </div>

                            <!-- Scraping Options -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Pages maximum</label>
                                    <select id="supervised-pages" class="input-modern">
                                        <option value="1">1 (Test rapide)</option>
                                        <option value="2" selected>2</option>
                                        <option value="5">5</option>
                                        <option value="10">10</option>
                                        <option value="20">20</option>
                                    </select>
                                </div>
                            </div>

                            <div class="actions">
                                <button class="btn btn-secondary" onclick="goBackToAnalyze()">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"/>
                                    </svg>
                                    Retour
                                </button>
                                <button class="btn btn-success btn-lg" onclick="startSupervisedScraping()">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/>
                                    </svg>
                                    Lancer le scraping complet
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Results -->
            <div id="step-results" class="step-section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2>‚úÖ R√©sultats du scraping</h2>
                        <span class="badge" id="result-count">0 entreprises</span>
                    </div>
                    <div class="card-body">
                        <div class="preview-list" id="result-preview"></div>

                        <div class="actions">
                            <button class="btn btn-secondary" onclick="exportData('csv')">
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/>
                                </svg>
                                Exporter CSV
                            </button>
                            <button class="btn btn-primary" onclick="continueToNextSteps()">
                                Continuer : Trouver les domaines
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"/>
                                </svg>
                            </button>
                            <button class="btn btn-secondary" onclick="startNewScraping()">
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"/>
                                </svg>
                                Nouveau scraping
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Modal -->
            <div class="modal" id="progress-modal" style="display: none;">
                <div class="modal-content modal-sm">
                    <div class="modal-header">
                        <h3 id="progress-title">Traitement en cours...</h3>
                    </div>
                    <div class="modal-body">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text" id="progress-text">0%</div>
                        <div class="progress-details" id="progress-details">Initialisation...</div>
                    </div>
                </div>
            </div>

            <!-- Config Modal -->
            <div class="modal" id="config-modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Configuration API</h3>
                        <button class="btn-close" onclick="closeConfig()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Cl√© API Pappers.fr</label>
                            <input type="text" id="pappers-key" class="input-modern" placeholder="Votre cl√© Pappers">
                            <small>Gratuit 10,000/mois - <a href="https://www.pappers.fr/api" target="_blank">Obtenir</a></small>
                        </div>
                        <div class="form-group">
                            <label>Cl√© API Hunter.io</label>
                            <input type="text" id="hunter-key" class="input-modern" placeholder="Votre cl√© Hunter">
                            <small>Gratuit 50/mois - <a href="https://hunter.io/users/sign_up" target="_blank">Obtenir</a></small>
                        </div>
                        <button class="btn btn-primary" onclick="saveConfig()">Sauvegarder</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/app_supervised.js') }}"></script>
</body>
</html>
